<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gentry Miller">

<title>Data Analysis Replication</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="gentrym1-AN588-Replication_files/libs/clipboard/clipboard.min.js"></script>
<script src="gentrym1-AN588-Replication_files/libs/quarto-html/quarto.js"></script>
<script src="gentrym1-AN588-Replication_files/libs/quarto-html/popper.min.js"></script>
<script src="gentrym1-AN588-Replication_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="gentrym1-AN588-Replication_files/libs/quarto-html/anchor.min.js"></script>
<link href="gentrym1-AN588-Replication_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="gentrym1-AN588-Replication_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="gentrym1-AN588-Replication_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="gentrym1-AN588-Replication_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="gentrym1-AN588-Replication_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#the-evolution-of-the-adolescent-growth-spurt-urinary-biomarkers-of-bone-turnover-in-wild-chimpanzees-pan-troglodytes" id="toc-the-evolution-of-the-adolescent-growth-spurt-urinary-biomarkers-of-bone-turnover-in-wild-chimpanzees-pan-troglodytes" class="nav-link active" data-scroll-target="#the-evolution-of-the-adolescent-growth-spurt-urinary-biomarkers-of-bone-turnover-in-wild-chimpanzees-pan-troglodytes">The evolution of the adolescent growth spurt: Urinary biomarkers of bone turnover in wild chimpanzees (<em>Pan troglodytes</em>)</a>
  <ul class="collapse">
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a>
  <ul class="collapse">
  <li><a href="#goals" id="toc-goals" class="nav-link" data-scroll-target="#goals">Goals</a></li>
  <li><a href="#data-breakdown" id="toc-data-breakdown" class="nav-link" data-scroll-target="#data-breakdown">Data Breakdown</a></li>
  <li><a href="#statistical-analysis-methods" id="toc-statistical-analysis-methods" class="nav-link" data-scroll-target="#statistical-analysis-methods">Statistical Analysis Methods</a></li>
  </ul></li>
  <li><a href="#replication" id="toc-replication" class="nav-link" data-scroll-target="#replication">Replication</a>
  <ul class="collapse">
  <li><a href="#setting-up" id="toc-setting-up" class="nav-link" data-scroll-target="#setting-up">Setting up</a></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling">Data Wrangling</a></li>
  <li><a href="#generating-models" id="toc-generating-models" class="nav-link" data-scroll-target="#generating-models">Generating Models</a></li>
  <li><a href="#plotting-our-results" id="toc-plotting-our-results" class="nav-link" data-scroll-target="#plotting-our-results">Plotting our Results</a></li>
  <li><a href="#summarizing-results" id="toc-summarizing-results" class="nav-link" data-scroll-target="#summarizing-results">Summarizing Results</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Analysis Replication</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gentry Miller </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="the-evolution-of-the-adolescent-growth-spurt-urinary-biomarkers-of-bone-turnover-in-wild-chimpanzees-pan-troglodytes" class="level1">
<h1>The evolution of the adolescent growth spurt: Urinary biomarkers of bone turnover in wild chimpanzees (<em>Pan troglodytes</em>)</h1>
<p><strong>Aaron A. Sandel, Jacob D. Negrey, Milja Arponen, Isabelle R. Clark, Jeremy B. Clift, Rachna B. Reddy, Kaisa K. Ivaska</strong></p>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>Sandel et al.&nbsp;(2023) investigate how collagen-type 1 cross-linked N-telopeptides (CTX) and osteocalcin vary with age to approximate bone turnover rates throughout a wild chimpanzee’s (<em>Pan troglodytes</em>) life history. Using urine samples from individuals with known ages, they asses developmental and aging patterns in skeletal metabolism. They found that chimpanzees exhibit sex-specific aging trajectories, with males and females showing different ages of peak turnover rates which reflects differences in growth and aging that are consistent with current hypotheses about the evolution of primate life history.</p>
<section id="goals" class="level3">
<h3 class="anchored" data-anchor-id="goals">Goals</h3>
<p>Their specific goal was to quantify age and sex related patterns of bone turnover through urinary biomarker assays. After collecting their data and performing analysis with generalized additive models, they cast out sex as a predictor because it “exhibited minimal effect on either collagen or osteocalcin levels” (Sandel et al.&nbsp;2023, p.&nbsp;4-5).</p>
</section>
<section id="data-breakdown" class="level3">
<h3 class="anchored" data-anchor-id="data-breakdown">Data Breakdown</h3>
<p>The data consist of two separate .csv files - one for each biomarker. The variables are mostly the same between the two data sets. The variables containing information about the chimpanzee include the individual’s ID (name), their sex, the age at which each sample was collected, and the individual’s date of birth. The sample-related variables include a unique ID for each sample from each individual, the date and time of collection, the researcher who collected the sample, the substrate from which the sample was collected, creatinine level, specific gravity, and the concentration of the relevant biomarker in both nM and ng/ml.</p>
</section>
<section id="statistical-analysis-methods" class="level3">
<h3 class="anchored" data-anchor-id="statistical-analysis-methods">Statistical Analysis Methods</h3>
<p>The authors used generalized additive models (GAMs) with cubic regression splines to model the concentration of each biomarker as a smooth function of age for both sexes together, only males, and only females for a total of 6 GAMs (2 biomarkers, 3 models each). They then used derivative analysis to identify the ages with the maximum predicted values for bone turnover, which they interpret as supporting evidence for a juvenile growth spurt. Similarly, they used segmented linear regressions to confirm distinct, age-related patterns in bone metabolism and were able to align their findings with the three stages of chimpanzee life history (infant, juvenile, adult).</p>
<p>I intend to replicate all 6 models used in the author’s analysis and attempt to replicate the figures presented in the results section of their paper.</p>
</section>
</section>
<section id="replication" class="level2">
<h2 class="anchored" data-anchor-id="replication">Replication</h2>
<section id="setting-up" class="level3">
<h3 class="anchored" data-anchor-id="setting-up">Setting up</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"https://raw.githubusercontent.com/bygentry/AN588_DataAnalysisRecreation_gentrym1/refs/heads/main/scripts/steup.R"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(collag1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">individualID</th>
<th style="text-align: left;">Sex</th>
<th style="text-align: right;">NTXnM_SG</th>
<th style="text-align: right;">timeSt</th>
<th style="text-align: right;">ageSt</th>
<th style="text-align: right;">sampleAge</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Amina</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">69.144813</td>
<td style="text-align: right;">1.5551050</td>
<td style="text-align: right;">-1.0988008</td>
<td style="text-align: right;">5.14</td>
</tr>
<tr class="even">
<td style="text-align: left;">Amina</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">28.993827</td>
<td style="text-align: right;">1.2255276</td>
<td style="text-align: right;">-1.0875272</td>
<td style="text-align: right;">5.28</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Amina</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">41.734612</td>
<td style="text-align: right;">1.3903163</td>
<td style="text-align: right;">-1.0134438</td>
<td style="text-align: right;">6.20</td>
</tr>
<tr class="even">
<td style="text-align: left;">Amina</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">21.881283</td>
<td style="text-align: right;">0.2829361</td>
<td style="text-align: right;">-1.0078070</td>
<td style="text-align: right;">6.27</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Amina</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">8.346056</td>
<td style="text-align: right;">-0.5344159</td>
<td style="text-align: right;">-0.9997544</td>
<td style="text-align: right;">6.37</td>
</tr>
<tr class="even">
<td style="text-align: left;">Amina</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">10.163696</td>
<td style="text-align: right;">0.4345417</td>
<td style="text-align: right;">-0.9997544</td>
<td style="text-align: right;">6.37</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(osteoc1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">individualID</th>
<th style="text-align: left;">Sex</th>
<th style="text-align: right;">uMidOC_SG</th>
<th style="text-align: right;">timeSt</th>
<th style="text-align: right;">ageSt</th>
<th style="text-align: right;">sampleAge</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Amina</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">0.3749446</td>
<td style="text-align: right;">1.5565127</td>
<td style="text-align: right;">-1.090409</td>
<td style="text-align: right;">5.14</td>
</tr>
<tr class="even">
<td style="text-align: left;">Amina</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">0.3472204</td>
<td style="text-align: right;">1.2257233</td>
<td style="text-align: right;">-1.079332</td>
<td style="text-align: right;">5.28</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Amina</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">0.3128981</td>
<td style="text-align: right;">1.3911180</td>
<td style="text-align: right;">-1.006538</td>
<td style="text-align: right;">6.20</td>
</tr>
<tr class="even">
<td style="text-align: left;">Amina</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">0.2819672</td>
<td style="text-align: right;">0.2796659</td>
<td style="text-align: right;">-1.000999</td>
<td style="text-align: right;">6.27</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Amina</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">0.1522141</td>
<td style="text-align: right;">-0.5406916</td>
<td style="text-align: right;">-0.993087</td>
<td style="text-align: right;">6.37</td>
</tr>
<tr class="even">
<td style="text-align: left;">Amina</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">0.2544156</td>
<td style="text-align: right;">0.4318290</td>
<td style="text-align: right;">-0.993087</td>
<td style="text-align: right;">6.37</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Using our setup script, we load the necessary packages and data before prepping the data for analysis. To prepare the data and maintain consistency with the original analysis,</p>
<ol type="1">
<li>both .csv files are transformed to tables</li>
<li>“Morton”’s sample is removed</li>
<li>the time variable is reformatted to h:m:s</li>
<li>continuous variables are standardized using Z-transformation</li>
<li>relevant variables are extracted</li>
<li><code>NA</code> values are omitted from the data sets.</li>
</ol>
</section>
<section id="data-wrangling" class="level3">
<h3 class="anchored" data-anchor-id="data-wrangling">Data Wrangling</h3>
<section id="averaging" class="level4">
<h4 class="anchored" data-anchor-id="averaging">Averaging</h4>
<p>Let’s take the averages for each individual</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>coll_data <span class="ot">&lt;-</span> collag1 <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(individualID) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the mean age across sample collection dates for each individual</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_age =</span> <span class="fu">mean</span>(sampleAge),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the mean concentration of collagen (corr. SG) for each individual</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_con =</span> <span class="fu">mean</span>(NTXnM_SG),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex =</span> <span class="fu">first</span>(Sex)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>ostc_data <span class="ot">&lt;-</span> osteoc1 <span class="sc">%&gt;%</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(individualID) <span class="sc">%&gt;%</span> </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the mean age across sample collection dates for each individual</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_age =</span> <span class="fu">mean</span>(sampleAge),</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the mean concentration of osteocalcin (corr. SG) for each individual</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_con =</span> <span class="fu">mean</span>(uMidOC_SG),</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex =</span> <span class="fu">first</span>(Sex)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and make some pointers for easier calls throughout this analysis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>c_con <span class="ot">&lt;-</span> coll_data<span class="sc">$</span>mean_con</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>c_age <span class="ot">&lt;-</span> coll_data<span class="sc">$</span>mean_age</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>o_con <span class="ot">&lt;-</span> ostc_data<span class="sc">$</span>mean_con</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>o_age <span class="ot">&lt;-</span> ostc_data<span class="sc">$</span>mean_age</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="box-cox-transformation" class="level4">
<h4 class="anchored" data-anchor-id="box-cox-transformation">Box-Cox Transformation</h4>
<p>We then apply a Box-Cox transformation to the biomarker concentration data to ensure we meet the assumptions of generalized additive modelling (GAM) and segmented regression (SR) and increase our confidence in the models:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a plot grid to present the boxcox results side-by-side</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># use Box-Cox from the MASS package to estimate the optimal lambda for approximating normality</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">boxcox</span>(<span class="fu">lm</span>(c_con <span class="sc">~</span> c_age))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"A. Collagen"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">boxcox</span>(<span class="fu">lm</span>(o_con <span class="sc">~</span> o_age))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"B. Osteocalcin"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gentrym1-AN588-Replication_files/figure-html/Box-Cox%20-%20Calculating%20Lambda-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now that we have our <span class="math inline">\(\lambda\)</span> we can apply the transformation to approximate a normal residual distribution:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the lambda </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">boxcox</span>(<span class="fu">lm</span>(c_con <span class="sc">~</span> c_age))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>lambda_c <span class="ot">&lt;-</span> b<span class="sc">$</span>x[<span class="fu">which.max</span>(b<span class="sc">$</span>y)]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the lambda</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">boxcox</span>(<span class="fu">lm</span>(o_con <span class="sc">~</span> o_age))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>lambda_oc <span class="ot">&lt;-</span> b<span class="sc">$</span>x[<span class="fu">which.max</span>(b<span class="sc">$</span>y)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Both our <span class="math inline">\(\lambda\)</span> values are above 0, which we can verify</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Collagen Lambda: 0.18182"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Osteocalcin Lambda: 0.38384"</code></pre>
</div>
</div>
<p>Since <span class="math inline">\(\lambda\)</span> is greater than 0, we use the formula <code>(y^lambda - 1) / lambda</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># apply the transformation</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>coll_data<span class="sc">$</span>c_conT <span class="ot">&lt;-</span> (c_con<span class="sc">^</span>lambda_c <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> lambda_c</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>ostc_data<span class="sc">$</span>o_conT <span class="ot">&lt;-</span> (o_con<span class="sc">^</span>lambda_oc <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> lambda_oc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="generating-models" class="level3">
<h3 class="anchored" data-anchor-id="generating-models">Generating Models</h3>
<section id="generalized-additive-models-gams" class="level4">
<h4 class="anchored" data-anchor-id="generalized-additive-models-gams">Generalized Additive Models (GAMs)</h4>
<p>Now that our data is transformed, we can create GAMs using the <code>gam()</code> function from the <code>mgcv</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># both sexes</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>cgam_mf <span class="ot">&lt;-</span> <span class="fu">gam</span>(c_conT <span class="sc">~</span> <span class="fu">s</span>(mean_age, <span class="at">bs =</span> <span class="st">"cr"</span>), <span class="at">method =</span> <span class="st">"REML"</span>, <span class="at">data =</span> coll_data)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>ogam_mf <span class="ot">&lt;-</span> <span class="fu">gam</span>(o_conT <span class="sc">~</span> <span class="fu">s</span>(mean_age, <span class="at">bs =</span> <span class="st">"cr"</span>), <span class="at">method =</span> <span class="st">"REML"</span>, <span class="at">data =</span> ostc_data)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># males only</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>cgam_m <span class="ot">&lt;-</span> <span class="fu">gam</span>(c_conT <span class="sc">~</span> <span class="fu">s</span>(mean_age, <span class="at">bs =</span> <span class="st">"cr"</span>), <span class="at">method =</span> <span class="st">"REML"</span>, <span class="at">data =</span> <span class="fu">filter</span>(coll_data, sex <span class="sc">==</span> <span class="st">"Male"</span>))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>ogam_m <span class="ot">&lt;-</span> <span class="fu">gam</span>(o_conT <span class="sc">~</span> <span class="fu">s</span>(mean_age, <span class="at">bs =</span> <span class="st">"cr"</span>), <span class="at">method =</span> <span class="st">"REML"</span>, <span class="at">data =</span> <span class="fu">filter</span>(ostc_data, sex <span class="sc">==</span> <span class="st">"Male"</span>))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># females only</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>cgam_f <span class="ot">&lt;-</span> <span class="fu">gam</span>(c_conT <span class="sc">~</span> <span class="fu">s</span>(mean_age, <span class="at">bs =</span> <span class="st">"cr"</span>), <span class="at">method =</span> <span class="st">"REML"</span>, <span class="at">data =</span> <span class="fu">filter</span>(coll_data, sex <span class="sc">==</span> <span class="st">"Female"</span>))</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>ogam_f <span class="ot">&lt;-</span> <span class="fu">gam</span>(o_conT <span class="sc">~</span> <span class="fu">s</span>(mean_age, <span class="at">bs =</span> <span class="st">"cr"</span>), <span class="at">method =</span> <span class="st">"REML"</span>, <span class="at">data =</span> <span class="fu">filter</span>(ostc_data, sex <span class="sc">==</span> <span class="st">"Female"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But we still need to extract the ages at which each GAM peaks and while we’re at it we can find the periods of significant change (where the derivative’s CI doesn’t contain 0)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>peak_ages <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># starting with collagen</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># make a dataframe of the derivatives of cgam</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>dts <span class="ot">&lt;-</span> <span class="fu">derivatives</span>(cgam_mf, <span class="at">select =</span> <span class="st">"s(mean_age)"</span>, <span class="at">interval =</span> <span class="st">"simultaneous"</span>, <span class="at">partial_match =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the inflection point (should be the peak of the model)</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>inflect <span class="ot">&lt;-</span> <span class="fu">with</span>(dts, <span class="fu">which</span>(<span class="fu">diff</span>(<span class="fu">sign</span>(.derivative)) <span class="sc">==</span> <span class="sc">-</span><span class="dv">2</span>))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add 1 because stack overflow said so</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>peak_ages<span class="sc">$</span>CollagenMF <span class="ot">&lt;-</span> dts<span class="sc">$</span>mean_age[inflect <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># let's add a direction column to find the signficant periods of change</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>dts <span class="ot">&lt;-</span> dts <span class="sc">%&gt;%</span> </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>      .lower_ci <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"increasing"</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>      .upper_ci <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"decreasing"</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"nonsig"</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co"># and extract the significant values</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>sig_dts <span class="ot">&lt;-</span> dts <span class="sc">%&gt;%</span> </span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sig <span class="sc">!=</span> <span class="st">"nonsig"</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="co"># finally, we can group the consecutive rows then extract the min and max to define our periods of significant change</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>sig_period <span class="ot">&lt;-</span> sig_dts <span class="sc">%&gt;%</span> </span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="fu">with</span>(<span class="fu">rle</span>(sig), <span class="fu">rep</span>(<span class="fu">seq_along</span>(lengths), lengths))</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group, sig) <span class="sc">%&gt;%</span> </span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">start =</span> <span class="fu">min</span>(mean_age), <span class="at">end =</span> <span class="fu">max</span>(mean_age), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>sig_period</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">group</th>
<th style="text-align: left;">sig</th>
<th style="text-align: right;">start</th>
<th style="text-align: right;">end</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">decreasing</td>
<td style="text-align: right;">13.37091</td>
<td style="text-align: right;">17.22182</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Now we just need to repeat this process for all of the other models</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now we repeat for all the other models</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cgam_m</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>dts <span class="ot">&lt;-</span> <span class="fu">derivatives</span>(cgam_m, <span class="at">select =</span> <span class="st">"s(mean_age)"</span>, <span class="at">interval =</span> <span class="st">"simultaneous"</span>, <span class="at">partial_match =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># here, we have to use first() because there are multiple inflection points</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>inflect <span class="ot">&lt;-</span> <span class="fu">first</span>(<span class="fu">with</span>(dts, <span class="fu">which</span>(<span class="fu">diff</span>(<span class="fu">sign</span>(.derivative)) <span class="sc">==</span> <span class="sc">-</span><span class="dv">2</span>)))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>peak_ages<span class="sc">$</span>CollagenM <span class="ot">&lt;-</span> dts<span class="sc">$</span>mean_age[inflect <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># cgam_f</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>dts <span class="ot">&lt;-</span> <span class="fu">derivatives</span>(cgam_f, <span class="at">select =</span> <span class="st">"s(mean_age)"</span>, <span class="at">interval =</span> <span class="st">"simultaneous"</span>, <span class="at">partial_match =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>inflect <span class="ot">&lt;-</span> <span class="fu">with</span>(dts, <span class="fu">which</span>(<span class="fu">diff</span>(<span class="fu">sign</span>(.derivative)) <span class="sc">==</span> <span class="sc">-</span><span class="dv">2</span>))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>peak_ages<span class="sc">$</span>CollagenF <span class="ot">&lt;-</span> dts<span class="sc">$</span>mean_age[inflect <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ogam_mf</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>dts <span class="ot">&lt;-</span> <span class="fu">derivatives</span>(ogam_mf, <span class="at">select =</span> <span class="st">"s(mean_age)"</span>, <span class="at">interval =</span> <span class="st">"simultaneous"</span>, <span class="at">partial_match =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># here, we have to use first() because there are multiple inflection points</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>inflect <span class="ot">&lt;-</span> <span class="fu">first</span>(<span class="fu">with</span>(dts, <span class="fu">which</span>(<span class="fu">diff</span>(<span class="fu">sign</span>(.derivative)) <span class="sc">==</span> <span class="sc">-</span><span class="dv">2</span>)))</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>peak_ages<span class="sc">$</span>OsteocalcinMF <span class="ot">&lt;-</span> dts<span class="sc">$</span>mean_age[inflect <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ogam_m</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>dts <span class="ot">&lt;-</span> <span class="fu">derivatives</span>(ogam_m, <span class="at">select =</span> <span class="st">"s(mean_age)"</span>, <span class="at">interval =</span> <span class="st">"simultaneous"</span>, <span class="at">partial_match =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co"># here, we have to use first() because there are multiple inflection points</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>inflect <span class="ot">&lt;-</span> <span class="fu">first</span>(<span class="fu">with</span>(dts, <span class="fu">which</span>(<span class="fu">diff</span>(<span class="fu">sign</span>(.derivative)) <span class="sc">==</span> <span class="sc">-</span><span class="dv">2</span>)))</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>peak_ages<span class="sc">$</span>OsteocalcinM <span class="ot">&lt;-</span> dts<span class="sc">$</span>mean_age[inflect <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ogam_f</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>dts <span class="ot">&lt;-</span> <span class="fu">derivatives</span>(ogam_f, <span class="at">select =</span> <span class="st">"s(mean_age)"</span>, <span class="at">interval =</span> <span class="st">"simultaneous"</span>, <span class="at">partial_match =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>inflect <span class="ot">&lt;-</span> <span class="fu">with</span>(dts, <span class="fu">which</span>(<span class="fu">diff</span>(<span class="fu">sign</span>(.derivative)) <span class="sc">==</span> <span class="sc">-</span><span class="dv">2</span>))</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>peak_ages<span class="sc">$</span>OsteocalcinF <span class="ot">&lt;-</span> dts<span class="sc">$</span>mean_age[inflect <span class="sc">+</span> <span class="dv">1</span>]</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">cgam_mf =</span> cgam_mf, <span class="at">cgam_m =</span> cgam_m, <span class="at">cgam_f =</span> cgam_f, <span class="at">ogam_mf =</span> ogam_mf, <span class="at">ogam_m =</span> ogam_m, <span class="at">ogam_f =</span> ogam_f)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>period_list <span class="ot">&lt;-</span> <span class="fu">imap_dfr</span>(models, <span class="cf">function</span>(model, name){</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  dts <span class="ot">&lt;-</span> <span class="fu">derivatives</span>(model, <span class="at">select =</span> <span class="st">"s(mean_age)"</span>, <span class="at">interval =</span> <span class="st">"simultaneous"</span>, <span class="at">partial_match =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">sig =</span> <span class="fu">case_when</span>(</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>        .lower_ci <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"increasing"</span>,</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>        .upper_ci <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"decreasing"</span>,</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"nonsig"</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(sig <span class="sc">!=</span> <span class="st">"nonsig"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">with</span>(<span class="fu">rle</span>(sig), <span class="fu">rep</span>(<span class="fu">seq_along</span>(lengths), lengths))) <span class="sc">%&gt;%</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(group, sig) <span class="sc">%&gt;%</span> </span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">start =</span> <span class="fu">min</span>(mean_age), <span class="at">end =</span> <span class="fu">max</span>(mean_age), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> name)</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `summarise()`.
The first warning was:
ℹ In argument: `start = min(mean_age)`.
Caused by warning in `min()`:
! no non-missing arguments to min; returning Inf
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>period_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">group</th>
<th style="text-align: left;">sig</th>
<th style="text-align: right;">start</th>
<th style="text-align: right;">end</th>
<th style="text-align: left;">model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">decreasing</td>
<td style="text-align: right;">13.370909</td>
<td style="text-align: right;">17.22182</td>
<td style="text-align: left;">cgam_mf</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">decreasing</td>
<td style="text-align: right;">12.981566</td>
<td style="text-align: right;">16.98978</td>
<td style="text-align: left;">cgam_m</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">decreasing</td>
<td style="text-align: right;">13.760202</td>
<td style="text-align: right;">20.76798</td>
<td style="text-align: left;">cgam_f</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">decreasing</td>
<td style="text-align: right;">12.729091</td>
<td style="text-align: right;">36.47636</td>
<td style="text-align: left;">ogam_mf</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">decreasing</td>
<td style="text-align: right;">8.026566</td>
<td style="text-align: right;">24.59040</td>
<td style="text-align: left;">ogam_f</td>
</tr>
</tbody>
</table>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Don't forget the peak ages:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Don't forget the peak ages:"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(peak_ages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              [,1]     
CollagenMF    10.16182 
CollagenM     10.97746 
CollagenF     numeric,0
OsteocalcinMF 8.236364 
OsteocalcinM  9.474377 
OsteocalcinF  numeric,0</code></pre>
</div>
</div>
<p>I could not for the life of me get a nonzero value for the two female models. As far as I can tell, this comes from the behavior of the <code>gratia</code> package. I think the problem is either caused by derivative being too flat at the inflection point such that when <code>gratia</code> smooths, it misses the inflection point OR the confidence interval of the derivative overlaps with 0 at the inflection point. I suppose the sample size could also be playing a role, but long story short I couldn’t get it to recognize either of the inflection points seen in the visualizations of the female models. When inspecting the derivatives, the inflection point for cgam_f can be seen between dts$.derivative[73] and dts$.derivative[74] at very small decimal values which supports my idea that the <code>gratia</code> package is smoothing over the inflection point.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dts <span class="ot">&lt;-</span> <span class="fu">derivatives</span>(cgam_f, <span class="at">select =</span> <span class="st">"s(mean_age)"</span>, <span class="at">interval =</span> <span class="st">"simultaneous"</span>, <span class="at">partial_match =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">with</span>(dts, .derivative)[<span class="dv">70</span><span class="sc">:</span><span class="dv">80</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           70            71            72            73            74 
-3.051611e-03 -2.245530e-03 -1.466773e-03 -7.153421e-04  8.766906e-06 
           75            76            77            78            79 
 7.055492e-04  1.375005e-03  2.017139e-03  2.631947e-03  3.219429e-03 
           80 
 3.779586e-03 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">with</span>(dts, .derivative)[<span class="dv">73</span><span class="sc">:</span><span class="dv">74</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           73            74 
-7.153421e-04  8.766906e-06 </code></pre>
</div>
</div>
<p>And the same can be seen in ogam_f at derivative indices 67-68:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>dts <span class="ot">&lt;-</span> <span class="fu">derivatives</span>(ogam_f, <span class="at">select =</span> <span class="st">"s(mean_age)"</span>, <span class="at">interval =</span> <span class="st">"simultaneous"</span>, <span class="at">partial_match =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">with</span>(dts, .derivative)[<span class="dv">64</span><span class="sc">:</span><span class="dv">74</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           64            65            66            67            68 
-0.0041987946 -0.0030302833 -0.0018946899 -0.0007920095  0.0002777559 
           69            70            71            72            73 
 0.0013146036  0.0023185351  0.0032895521  0.0042276527  0.0051328380 
           74 
 0.0060051076 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">with</span>(dts, .derivative)[<span class="dv">67</span><span class="sc">:</span><span class="dv">68</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           67            68 
-0.0007920095  0.0002777559 </code></pre>
</div>
</div>
<p>I include a range of 10 values around the inflection point to demonstrate that it is not an instantaneous change in sign and represents a true inflection point.</p>
</section>
<section id="segmented-regressions" class="level4">
<h4 class="anchored" data-anchor-id="segmented-regressions">Segmented Regressions</h4>
<p>Moving on, let’s make our segmented regressions using <code>segmented()</code> from the package <code>segmented</code> using linear models</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># both sexes</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>csr_mf <span class="ot">&lt;-</span> <span class="fu">segmented</span>(<span class="fu">lm</span>(c_conT <span class="sc">~</span> mean_age, <span class="at">data =</span> coll_data), <span class="at">seg.Z =</span> <span class="sc">~</span>mean_age, <span class="at">npsi =</span> <span class="dv">3</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>osr_mf <span class="ot">&lt;-</span> <span class="fu">segmented</span>(<span class="fu">lm</span>(o_conT <span class="sc">~</span> mean_age, <span class="at">data =</span> ostc_data), <span class="at">seg.Z =</span> <span class="sc">~</span>mean_age, <span class="at">npsi =</span> <span class="dv">3</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># males only</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>csr_m <span class="ot">&lt;-</span> <span class="fu">segmented</span>(<span class="fu">lm</span>(c_conT <span class="sc">~</span> mean_age, <span class="at">data =</span> <span class="fu">filter</span>(coll_data, sex <span class="sc">==</span> <span class="st">"Male"</span>)), <span class="at">seg.Z =</span> <span class="sc">~</span>mean_age, <span class="at">npsi =</span> <span class="dv">3</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>osr_m <span class="ot">&lt;-</span> <span class="fu">segmented</span>(<span class="fu">lm</span>(o_conT <span class="sc">~</span> mean_age, <span class="at">data =</span> <span class="fu">filter</span>(ostc_data, sex <span class="sc">==</span> <span class="st">"Male"</span>)), <span class="at">seg.Z =</span> <span class="sc">~</span>mean_age, <span class="at">npsi =</span> <span class="dv">3</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># females only</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>csr_f <span class="ot">&lt;-</span> <span class="fu">segmented</span>(<span class="fu">lm</span>(c_conT <span class="sc">~</span> mean_age, <span class="at">data =</span> <span class="fu">filter</span>(coll_data, sex <span class="sc">==</span> <span class="st">"Female"</span>)), <span class="at">seg.Z =</span> <span class="sc">~</span>mean_age, <span class="at">npsi =</span> <span class="dv">3</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>osr_f <span class="ot">&lt;-</span> <span class="fu">segmented</span>(<span class="fu">lm</span>(o_conT <span class="sc">~</span> mean_age, <span class="at">data =</span> <span class="fu">filter</span>(ostc_data, sex <span class="sc">==</span> <span class="st">"Female"</span>)), <span class="at">seg.Z =</span> <span class="sc">~</span>mean_age, <span class="at">npsi =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="checking-our-models" class="level4">
<h4 class="anchored" data-anchor-id="checking-our-models">Checking our Models</h4>
<p>and let’s go ahead and run our checks for both types of model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># these outputs are crazy long and frankly not that relevant to this assignment, so i turned eval to false for this chunk.</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gam.check</span>(cgam_mf, <span class="at">level =</span> .<span class="dv">95</span>);<span class="fu">gam.check</span>(cgam_m, <span class="at">level =</span> .<span class="dv">95</span>);<span class="fu">gam.check</span>(cgam_f, <span class="at">level =</span> .<span class="dv">95</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">gam.check</span>(ogam_mf, <span class="at">level =</span> .<span class="dv">95</span>);<span class="fu">gam.check</span>(ogam_m, <span class="at">level =</span> .<span class="dv">95</span>);<span class="fu">gam.check</span>(cgam_f, <span class="at">level =</span> .<span class="dv">95</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(csr_mf, <span class="at">level =</span> .<span class="dv">95</span>);<span class="fu">shapiro.test</span>(csr_m, <span class="at">level =</span> .<span class="dv">95</span>);<span class="fu">shapiro.test</span>(csr_f, <span class="at">level =</span> .<span class="dv">95</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(osr_mf, <span class="at">level =</span> .<span class="dv">95</span>);<span class="fu">shapiro.test</span>(osr_m, <span class="at">level =</span> .<span class="dv">95</span>);<span class="fu">shapiro.test</span>(osr_f, <span class="at">level =</span> .<span class="dv">95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="plotting-our-results" class="level3">
<h3 class="anchored" data-anchor-id="plotting-our-results">Plotting our Results</h3>
<section id="results-for-both-sexes" class="level4">
<h4 class="anchored" data-anchor-id="results-for-both-sexes">Results for Both Sexes</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GAMs</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create a dataframe of values fitted to the model</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>fitted_df <span class="ot">&lt;-</span> <span class="fu">fitted_values</span>(cgam_mf, <span class="at">data =</span> coll_data, <span class="at">include_data =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="st">"response"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>p.cgmf <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fitted_df, <span class="fu">aes</span>(<span class="at">x =</span> mean_age, <span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> .lower_ci, <span class="at">ymax =</span> .upper_ci), <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue4"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> c_conT), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age (Years)"</span>,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Collagen (nM, SG-corrected)"</span>,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"GAM Fit with 95% CI"</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">4</span>),</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">aspect.ratio =</span> <span class="fl">1.2</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>fitted_df <span class="ot">&lt;-</span> <span class="fu">fitted_values</span>(ogam_mf, <span class="at">data =</span> ostc_data, <span class="at">include_data =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="st">"response"</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>p.ogmf <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fitted_df, <span class="fu">aes</span>(<span class="at">x =</span> mean_age, <span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> .lower_ci, <span class="at">ymax =</span> .upper_ci), <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue4"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> o_conT), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age (Years)"</span>,</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Osteocalcin (ng/mL, SG-corrected)"</span>,</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"GAM Fit with 95% CI"</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">4</span>),</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">aspect.ratio =</span> <span class="fl">1.2</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a><span class="co"># SRs</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a><span class="co"># generate prediction data</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>newdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mean_age =</span> <span class="fu">seq</span>(<span class="fu">min</span>(coll_data<span class="sc">$</span>mean_age),</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">max</span>(coll_data<span class="sc">$</span>mean_age),</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">length.out =</span> <span class="dv">1000</span>))</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">predict</span>(csr_mf, <span class="at">newdata =</span> newdata, <span class="at">interval =</span> <span class="st">"confidence"</span>)</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">cbind</span>(newdata, <span class="fu">as.data.frame</span>(b))</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>p.csmf <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(coll_data, <span class="fu">aes</span>(<span class="at">x =</span> mean_age, <span class="at">y =</span> c_conT)) <span class="sc">+</span></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> preds, <span class="fu">aes</span>(<span class="at">y =</span> fit), <span class="at">color =</span> <span class="st">"red3"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age (Years)"</span>,</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Collagen (nM, SG-corrected)"</span>,</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"SR Fit"</span>,</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">aspect.ratio =</span> <span class="fl">1.2</span></span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">predict</span>(osr_mf, <span class="at">newdata =</span> newdata, <span class="at">interval =</span> <span class="st">"confidence"</span>)</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">cbind</span>(newdata, <span class="fu">as.data.frame</span>(b))</span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>p.osmf <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fitted_df, <span class="fu">aes</span>(<span class="at">x =</span> mean_age, <span class="at">y =</span> o_conT)) <span class="sc">+</span></span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> preds, <span class="fu">aes</span>(<span class="at">y =</span> fit), <span class="at">color =</span> <span class="st">"red3"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Osteocalcin (ng/mL, SG-corrected)"</span>,</span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"SR Fit"</span>,</span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">aspect.ratio =</span> <span class="fl">1.2</span></span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p.cgmf, p.ogmf, p.csmf, p.osmf, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gentrym1-AN588-Replication_files/figure-html/making%20plots%20-%20both%20sexes-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Comparing my results to those from the study</p>
</section>
<section id="sandel-et-al.-figure-1-both-sexes" class="level4">
<h4 class="anchored" data-anchor-id="sandel-et-al.-figure-1-both-sexes">Sandel et al.&nbsp;Figure 1: Both Sexes</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/figure1.png" class="img-fluid figure-img"></p>
<figcaption>Biomarker levels in chimpanzees, including males and females. Collagen is an indicator of bone resorption and osteocalcin is an indicator of bone formation. We transformed collagen and osteocalcin values to approximate a normal residual distribution (Box and Cox, 1964). The solid blue lines (upper panels) represent the generalized additive models with confidence intervals as dashed lines; red lines (lower panels) represent segmented regressions. Dotted vertical lines are placed at age 5 years (end of infancy) and age 10 years (around early adolescence) to aid interpretation. (Sandel et al.&nbsp;2023 Figure 1)</figcaption>
</figure>
</div>
</section>
<section id="results-for-males-only" class="level4">
<h4 class="anchored" data-anchor-id="results-for-males-only">Results for Males Only</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GAMs</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>fitted_df <span class="ot">&lt;-</span> <span class="fu">fitted_values</span>(cgam_m, <span class="at">data =</span> coll_data, <span class="at">include_data =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="st">"response"</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>p.cgm <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fitted_df, <span class="fu">aes</span>(<span class="at">x =</span> mean_age, <span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> .lower_ci, <span class="at">ymax =</span> .upper_ci), <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue4"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> c_conT), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Collagen (nM, SG-corrected)"</span>,</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"GAM Fit with 95% CI"</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>fitted_df <span class="ot">&lt;-</span> <span class="fu">fitted_values</span>(ogam_m, <span class="at">data =</span> ostc_data, <span class="at">include_data =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="st">"response"</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>p.ogm <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fitted_df, <span class="fu">aes</span>(<span class="at">x =</span> mean_age, <span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> .lower_ci, <span class="at">ymax =</span> .upper_ci), <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue4"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> o_conT), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Osteocalcin (ng/mL, SG-corrected)"</span>,</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"GAM Fit with 95% CI"</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">predict</span>(csr_m, <span class="at">newdata =</span> newdata, <span class="at">interval =</span> <span class="st">"confidence"</span>)</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">cbind</span>(newdata, <span class="fu">as.data.frame</span>(b))</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>p.csm <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(coll_data, <span class="fu">aes</span>(<span class="at">x =</span> mean_age, <span class="at">y =</span> c_conT)) <span class="sc">+</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> preds, <span class="fu">aes</span>(<span class="at">y =</span> fit), <span class="at">color =</span> <span class="st">"red3"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age (Years)"</span>,</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Collagen (nM, SG-corrected)"</span>,</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"SR Fit"</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">predict</span>(osr_m, <span class="at">newdata =</span> newdata, <span class="at">interval =</span> <span class="st">"confidence"</span>)</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">cbind</span>(newdata, <span class="fu">as.data.frame</span>(b))</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>p.osm <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fitted_df, <span class="fu">aes</span>(<span class="at">x =</span> mean_age, <span class="at">y =</span> o_conT)) <span class="sc">+</span></span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> preds, <span class="fu">aes</span>(<span class="at">y =</span> fit), <span class="at">color =</span> <span class="st">"red3"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Osteocalcin (ng/mL, SG-corrected)"</span>,</span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"SR Fit"</span></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p.cgm, p.ogm, p.csm, p.osm,<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gentrym1-AN588-Replication_files/figure-html/making%20plots%20-%20males%20only-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sandel-et-al.-figure-2-males-only" class="level4">
<h4 class="anchored" data-anchor-id="sandel-et-al.-figure-2-males-only">Sandel et al.&nbsp;Figure 2: Males Only</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/figure2.png" class="img-fluid figure-img"></p>
<figcaption>Biomarker levels in male chimpanzees. We transformed collagen and osteocalcin values to approximate a normal residual distribution. The solid blue lines (upper panels) represent the generalized additive models (GAMs) with confidence intervals as dashed lines; red lines (bottom panels) represent segmented regressions. Among male chimpanzees, GAMs and segmented regressions indicate peaks of both biomarkers in early adolescence (9.4–10.8 years). Dotted vertical lines are placed at age 5 years (end of infancy) and age 10 years (around early adolescence) to aid interpretation</figcaption>
</figure>
</div>
</section>
<section id="results-for-females-only" class="level4">
<h4 class="anchored" data-anchor-id="results-for-females-only">Results for Females Only</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GAMs</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>fitted_df <span class="ot">&lt;-</span> <span class="fu">fitted_values</span>(cgam_f, <span class="at">data =</span> coll_data, <span class="at">include_data =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="st">"response"</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>p.cgf <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fitted_df, <span class="fu">aes</span>(<span class="at">x =</span> mean_age, <span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> .lower_ci, <span class="at">ymax =</span> .upper_ci), <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> c_conT), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Collagen (nM, SG-corrected)"</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"GAM Fit with 95% CI, Females"</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>fitted_df <span class="ot">&lt;-</span> <span class="fu">fitted_values</span>(ogam_f, <span class="at">data =</span> ostc_data, <span class="at">include_data =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="st">"response"</span>)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>p.ogf <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fitted_df, <span class="fu">aes</span>(<span class="at">x =</span> mean_age, <span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> .lower_ci, <span class="at">ymax =</span> .upper_ci), <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> o_conT), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Osteocalcin (ng/mL, SG-corrected)"</span>,</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"GAM Fit with 95% CI"</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">predict</span>(csr_f, <span class="at">newdata =</span> newdata, <span class="at">interval =</span> <span class="st">"confidence"</span>)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">cbind</span>(newdata, <span class="fu">as.data.frame</span>(b))</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>p.csf <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(coll_data, <span class="fu">aes</span>(<span class="at">x =</span> mean_age, <span class="at">y =</span> c_conT)) <span class="sc">+</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> preds, <span class="fu">aes</span>(<span class="at">y =</span> fit), <span class="at">color =</span> <span class="st">"red3"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age (Years)"</span>,</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Collagen (nM, SG-corrected)"</span>,</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"SR Fit"</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">predict</span>(osr_f, <span class="at">newdata =</span> newdata, <span class="at">interval =</span> <span class="st">"confidence"</span>)</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">cbind</span>(newdata, <span class="fu">as.data.frame</span>(b))</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>p.osf <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fitted_df, <span class="fu">aes</span>(<span class="at">x =</span> mean_age, <span class="at">y =</span> o_conT)) <span class="sc">+</span></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> preds, <span class="fu">aes</span>(<span class="at">y =</span> fit), <span class="at">color =</span> <span class="st">"red3"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Osteocalcin (ng/mL, SG-corrected)"</span>,</span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"SR Fit"</span></span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p.cgf, p.ogf, p.csf, p.osf, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gentrym1-AN588-Replication_files/figure-html/making%20plots%20-%20females%20only-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sandel-et-al.-figure-3-females-only" class="level4">
<h4 class="anchored" data-anchor-id="sandel-et-al.-figure-3-females-only">Sandel et al.&nbsp;Figure 3: Females Only</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/figure3.png" class="img-fluid figure-img"></p>
<figcaption>Biomarker levels in female chimpanzees. We transformed collagen and osteocalcin values to approximate a normal residual distribution. The solid blue lines (upper panels) represent the generalized additive models (GAMs) with confidence intervals as dashed lines; red lines (lower panels) represent segmented regression. Among female chimpanzees, GAMs suggest an incrementally lower turnover with age, but segmented regressions indicate a peak at 13 years for collagen and 7 years for osteocalcin.</figcaption>
</figure>
</div>
</section>
</section>
<section id="summarizing-results" class="level3">
<h3 class="anchored" data-anchor-id="summarizing-results">Summarizing Results</h3>
<p>Housekeeping:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prep for producing the table</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(peak_ages) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"cgam_mf"</span>, <span class="st">"cgam_m"</span>, <span class="st">"cgam_f"</span>, <span class="st">"ogam_mf"</span>, <span class="st">"ogam_m"</span>, <span class="st">"ogam_f"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>table_names <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">c</span>(<span class="st">"Collagen (All)"</span>, <span class="st">"Collagen (Male)"</span>, <span class="st">"Collagen (Female)"</span>, <span class="st">"Osteocalcin (All)"</span>, <span class="st">"Osteocalcin (Male)"</span>, <span class="st">"Osteocalcin (Female)"</span>))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>model.names <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">c</span>(<span class="st">"cgam_mf"</span>, <span class="st">"cgam_m"</span>, <span class="st">"cgam_f"</span>, <span class="st">"ogam_mf"</span>, <span class="st">"ogam_m"</span>, <span class="st">"ogam_f"</span>))</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>inputs <span class="ot">&lt;-</span> <span class="fu">list</span>(models, table_names, model.names)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the female models were being excluded because of they peak age being numeric(0), so overwrite with NA to ensure they're in the table</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>peak_ages<span class="sc">$</span>cgam_f <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>peak_ages<span class="sc">$</span>ogam_f <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Helper Functions:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>p.check <span class="ot">&lt;-</span> <span class="cf">function</span>(s){</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> s<span class="sc">$</span>s.table[<span class="dv">1</span>, <span class="st">"p-value"</span>]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p <span class="sc">&lt;</span> <span class="fl">1e-3</span>){</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="st">"&lt;0.001"</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">as.character</span>(<span class="fu">round</span>(p, <span class="dv">3</span>)))</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>b.check <span class="ot">&lt;-</span> <span class="cf">function</span>(b){</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if no significant period was detected, return NA else return significant period (b)</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(b <span class="sc">==</span> <span class="st">""</span>){</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(b)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Generating Table:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>gam_summary <span class="ot">&lt;-</span> <span class="fu">pmap_dfr</span>(inputs, <span class="cf">function</span>(model, table_name, model.name){</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  peak <span class="ot">&lt;-</span> peak_ages[[model.name]]</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> period_list <span class="sc">%&gt;%</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(model <span class="sc">==</span> model.name) <span class="sc">%&gt;%</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">interval =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(start, <span class="dv">2</span>), <span class="st">"-"</span>, <span class="fu">round</span>(end, <span class="dv">2</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(interval) <span class="sc">%&gt;%</span> </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">"; "</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model =</span> table_name,</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">nrow</span>(model<span class="sc">$</span>model),</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">EDF =</span> <span class="fu">round</span>(s<span class="sc">$</span>s.table[<span class="dv">1</span>, <span class="st">"edf"</span>], <span class="dv">2</span>),</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Ref.DF =</span> <span class="fu">round</span>(s<span class="sc">$</span>s.table[<span class="dv">1</span>, <span class="st">"Ref.df"</span>], <span class="dv">2</span>),</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">.F =</span> <span class="fu">round</span>(s<span class="sc">$</span>s.table[<span class="dv">1</span>, <span class="st">"F"</span>], <span class="dv">1</span>),</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">p.value =</span> <span class="fu">p.check</span>(s),</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Peak.Age =</span> <span class="fu">round</span>(peak, <span class="dv">2</span>),</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sig.Increase =</span> <span class="cn">NA</span>,</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sig.Decrease =</span> <span class="fu">b.check</span>(b)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>gam_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 24%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">N</th>
<th style="text-align: right;">EDF</th>
<th style="text-align: right;">Ref.DF</th>
<th style="text-align: right;">.F</th>
<th style="text-align: left;">p.value</th>
<th style="text-align: right;">Peak.Age</th>
<th style="text-align: left;">Sig.Increase</th>
<th style="text-align: left;">Sig.Decrease</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Collagen (All)</td>
<td style="text-align: right;">109</td>
<td style="text-align: right;">5.10</td>
<td style="text-align: right;">5.89</td>
<td style="text-align: right;">11.8</td>
<td style="text-align: left;">&lt;0.001</td>
<td style="text-align: right;">10.16</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">13.37-17.22</td>
</tr>
<tr class="even">
<td style="text-align: left;">Collagen (Male)</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">5.53</td>
<td style="text-align: right;">6.41</td>
<td style="text-align: right;">10.2</td>
<td style="text-align: left;">&lt;0.001</td>
<td style="text-align: right;">10.98</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">12.98-16.99</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Collagen (Female)</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">2.09</td>
<td style="text-align: right;">2.57</td>
<td style="text-align: right;">7.0</td>
<td style="text-align: left;">0.001</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">13.76-20.77</td>
</tr>
<tr class="even">
<td style="text-align: left;">Osteocalcin (All)</td>
<td style="text-align: right;">106</td>
<td style="text-align: right;">5.37</td>
<td style="text-align: right;">6.17</td>
<td style="text-align: right;">11.0</td>
<td style="text-align: left;">&lt;0.001</td>
<td style="text-align: right;">8.24</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">12.73-36.48</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Osteocalcin (Male)</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">4.53</td>
<td style="text-align: right;">5.38</td>
<td style="text-align: right;">3.6</td>
<td style="text-align: left;">0.005</td>
<td style="text-align: right;">9.47</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">Osteocalcin (Female)</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">2.68</td>
<td style="text-align: right;">3.23</td>
<td style="text-align: right;">16.3</td>
<td style="text-align: left;">&lt;0.001</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">8.03-24.59</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="sandel-et-al.-table-1" class="level4">
<h4 class="anchored" data-anchor-id="sandel-et-al.-table-1">Sandel et al.&nbsp;Table 1</h4>
<p><img src="img/table1.png" class="img-fluid"></p>
<p>My models all produced nearly identical values across the board except for the peak ages of the female models, the period of significant increase for the males only collagen model, and all of the periods of significant decrease. I’m not sure whether the inconsistent results were because I did something wrong, we used different versions of R and packages, or the fact that I have a silicon chip with a Windows OS. At one point the period of increase for the male only collagen model was being calculated correctly the the .1, but as I continued to work and re-run things my program stopped recognizing it. The same goes for the period of decrease associated with the male only osteocalcin model.</p>
<p>I don’t believe it’s an issue with my models or how I implemented the Box-Cox transformation for three reasons:</p>
<ol type="1">
<li>All of the values except for the periods of significant change are extremely close to those found by Sandel’s team</li>
<li>The values for the periods of change were initially much closer to Sandel et al.’s</li>
<li>The period of increase was initially recognized but somewhere down the line the derivative function stopped identifying significant values in the appropriate (or any) range</li>
</ol>
<p>Anyways, let’s compare the segmented regressions now.</p>
<p>Housekeeping:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>(csr_mf, csr_m, csr_f, osr_mf, osr_m, osr_f)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(models) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"csr_mf"</span>, <span class="st">"csr_m"</span>, <span class="st">"csr_f"</span>, <span class="st">"osr_mf"</span>, <span class="st">"osr_m"</span>, <span class="st">"osr_f"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>inputs <span class="ot">&lt;-</span> <span class="fu">list</span>(models, table_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>slr_summary <span class="ot">&lt;-</span> <span class="fu">pmap_dfr</span>(inputs, <span class="cf">function</span>(m, table_name){</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model =</span> table_name,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">N =</span> <span class="fu">nrow</span>(m<span class="sc">$</span>model),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Breakpoint1 =</span> <span class="fu">round</span>(m<span class="sc">$</span>psi[<span class="dv">1</span>,<span class="dv">2</span>], <span class="dv">1</span>),</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Breakpoint2 =</span> <span class="fu">round</span>(m<span class="sc">$</span>psi[<span class="dv">2</span>,<span class="dv">2</span>], <span class="dv">1</span>),</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Breakpoint3 =</span> <span class="fu">round</span>(m<span class="sc">$</span>psi[<span class="dv">3</span>,<span class="dv">2</span>], <span class="dv">1</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>slr_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">N</th>
<th style="text-align: right;">Breakpoint1</th>
<th style="text-align: right;">Breakpoint2</th>
<th style="text-align: right;">Breakpoint3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Collagen (All)</td>
<td style="text-align: right;">109</td>
<td style="text-align: right;">4.4</td>
<td style="text-align: right;">11.9</td>
<td style="text-align: right;">18.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Collagen (Male)</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">12.7</td>
<td style="text-align: right;">12.8</td>
<td style="text-align: right;">20.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Collagen (Female)</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">4.3</td>
<td style="text-align: right;">13.4</td>
<td style="text-align: right;">19.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Osteocalcin (All)</td>
<td style="text-align: right;">106</td>
<td style="text-align: right;">7.6</td>
<td style="text-align: right;">17.5</td>
<td style="text-align: right;">25.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Osteocalcin (Male)</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">10.9</td>
<td style="text-align: right;">16.9</td>
<td style="text-align: right;">28.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">Osteocalcin (Female)</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">7.4</td>
<td style="text-align: right;">13.9</td>
<td style="text-align: right;">49.8</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="sandel-et-al.-table-2" class="level4">
<h4 class="anchored" data-anchor-id="sandel-et-al.-table-2">Sandel et al.&nbsp;Table 2</h4>
<p><img src="img/table2.png" class="img-fluid"></p>
<p>These tables are also very close. It looks like my model identified a breakpoint (bp) for the female only collagen model at 4.3 years old that Sandel’s team’s models didn’t. As a consequence, their bp1 is my bp2 and their bp2 is my bp3 while their bp3 is <code>NA</code>.</p>
<p>Overall, I think I did a pretty good job replicating their analysis but I’m curious why the female only models behaved so strangely for me.</p>
</section>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>